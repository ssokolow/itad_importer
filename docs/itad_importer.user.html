<!DOCTYPE html>

<html>
<head>
  <title>itad_importer.user.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>itad_importer.user.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="isthereanydeal-com-collection-importer">IsThereAnyDeal.com Collection Importer</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>// ==UserScript==
// @name IsThereAnyDeal.com Collection Importer
// @version 0.1b16
// @namespace http://isthereanydeal.com/
// @description Adds buttons to various sites to export your game lists to ITAD
// @icon http://s3-eu-west-1.amazonaws.com/itad/images/banners/50x50.gif
// @license MIT
// @supportURL https://github.com/ssokolow/itad_importer/issues
// @grant GM_info
// @require https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js
//
// @match *://www.dotemu.com/*
// @match *://fireflowergames.com/my-lists/*
// @match *://flyingbundle.com/users/account
// @match *://www.flyingbundle.com/users/account
// @match *://www.gog.com/account*
// @match *://www.gog.com/order/status/*
// @match *://groupees.com/purchases*
// @match *://groupees.com/users/*
// @match *://www.humblebundle.com/home*
// @match *://www.humblebundle.com/downloads?key=*
// @match *://www.humblebundle.com/s?key=*
// @match *://indiegamestand.com/wallet.php
// @match *://indiegamestand.com/wishlist.php
// @match *://www.shinyloot.com/m/games*
// @match *://www.shinyloot.com/m/wishlist*
// ==/UserScript==

Any patches to this script should be made against the original
CoffeeScript source file available (and documented) at:

  https://github.com/ssokolow/itad_importer

Copyright ©2014-2015 Stephan Sokolow
License: MIT (http://opensource.org/licenses/MIT)

TODO:
- Add a `@downloadURL` for the script

Note: While we do not use GM_info, we must request it to force the userscript
to be isolated from the page so its jQuery doesn't collide with the site's
jQuery.</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This string will be interpreted as raw HTML</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>BUTTON_LABEL = <span class="hljs-string">"Export to ITAD"</span>

ITAD_12X12 = <span class="hljs-string">"""data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAMAAABhq6zVAAAAZlBMVEUEbrIEbrIJcbQLcrQefboo
g70rhb4thr8vh78zicA6jcNCksVLl8hWnctZn8xdoc1ipM9ipc9kptB5stZ6staCt9mHutqJu9ud
xuGozeSrz+W72OrA2+zJ4O7U5vLX6PPn8fj3+vyC0mvkAAAAAXRSTlMAQObYZgAAAFdJREFUCB0F
wYkCgUAABcA3CpElRyRH6/9/0kwCQALtZSwNglN9Pt5LR+jqGuelEaYbeBXh04P7KMwDeF6E8l1h
W1vh8PsO/bWeiGPdl/kzdYjdBkACQP5LygQ7CM8T6wAAAABJRU5ErkJggg=="""</span>

ITAD_14X14_GRAY = <span class="hljs-string">"""data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAMAAAAolt3jAAAAdVBMVEUEbrKTlaCTlZ+TlZ+UlqCY
maSYmqWcnqednqieoKmfoaugoqulprCvsLivsbiwsrmztLuztby2uL7BwsjDxcrExcvIyc7V1trW
1trX2Nvn5+rp6evx8vP19fb39/j4+Pn5+fr7+/v7+/z8/Pz8/P39/f3///8J+FboAAAAJHRSTlMA
y+rw8PHx8fHx8vLy9PT09PT19vf39/n5+fz8/f3+/v7+/v695LIzAAAAcUlEQVQIHQXBhwGCQAAE
sHui2FHsBeyy/4gmSQGgJKWCeTNFVQJNN9yH2xJB+z3WZuf3kjDuD+B8I6wfIzAbpsLuCrg3QtsD
9TAXJq8tOHYEl9+W0eHbEPaf06u/PvoWsXmuTNrdegwp1QJAVZICQMkf1qQG7Yh+Z60AAAAASUVO
RK5CYII="""</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Cache reused objects
Source: <a href="http://stackoverflow.com/a/196991">http://stackoverflow.com/a/196991</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>underscore_re = <span class="hljs-regexp">/_/g</span>
word_re = <span class="hljs-regexp">/\b\w+/g</span>
<span class="hljs-function"><span class="hljs-title">titlecase_cb</span> = <span class="hljs-params">(s)</span> -&gt;</span> s.charAt(<span class="hljs-number">0</span>).toUpperCase() + s.substr(<span class="hljs-number">1</span>).toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Less overhead than instantiating a new jQuery object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">attr</span> = <span class="hljs-params">(node, name)</span> -&gt;</span> node.getAttribute(name)
<span class="hljs-function">
<span class="hljs-title">dotemu_add_button</span> = <span class="hljs-params">(parent_selector)</span> -&gt;</span>
  $(<span class="hljs-string">'&lt;button&gt;&lt;/button&gt;'</span>)
  .html(BUTTON_LABEL).css</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>DotEmu doesn’t have a general button style we can use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    float: <span class="hljs-string">'right'</span>
    marginRight: <span class="hljs-string">'5px'</span>
  .appendTo(parent_selector)
<span class="hljs-function">
<span class="hljs-title">gog_prepare_title</span> = <span class="hljs-params">(elem)</span> -&gt;</span>
  dom = $(<span class="hljs-string">'.product-title'</span>, elem).clone()
  $(<span class="hljs-string">'._product-flag'</span>, dom).remove()
  dom.text()</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>inject the buttons after the a tab gets populated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">humble_make_library_button</span> = -&gt;</span>
  button = $(<span class="hljs-string">'&lt;button class="download-button"&gt;&lt;/button&gt;'</span>)
    .html(BUTTON_LABEL)
    .css</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>I wish they wouldn’t make their CSS rules so specific</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      display: <span class="hljs-string">'inline'</span>,
      border: <span class="hljs-string">'1px solid #CCC'</span>,
      background: <span class="hljs-string">'#F1F3F6'</span>,
      padding: <span class="hljs-string">'5px 10px 5px 10px'</span>,
      marginLeft: <span class="hljs-string">'10px'</span>,

  holders = [
    {
      tab: $(<span class="hljs-string">"a.tabbar-tab[href$='library'"</span>),
      holder: $(<span class="hljs-string">'.js-library-holder'</span>),
      insertSelector: <span class="hljs-string">'.top-controls'</span>},
    {
      tab: $(<span class="hljs-string">"a.tabbar-tab[href$='keys'"</span>),
      holder: $(<span class="hljs-string">'.js-key-manager-holder'</span>),
      insertSelector: <span class="hljs-string">'.header .container:last'</span>},
    {
      tab: $(<span class="hljs-string">"a.tabbar-tab[href$='purchases'"</span>),
      holder: $(<span class="hljs-string">'.js-purchase-holder'</span>),
      insertSelector: <span class="hljs-string">'.header .container:last'</span>}]
<span class="hljs-function">
  <span class="hljs-title">updateButton</span> = <span class="hljs-params">(holder, insertSelector)</span> -&gt;</span>
    found = holder.find(insertSelector)
    <span class="hljs-keyword">if</span> found.length &gt; <span class="hljs-number">0</span>
      found2 = found.find(<span class="hljs-string">".itad_btn"</span>)
      <span class="hljs-keyword">if</span> found2.length == <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <pre><code>     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Inserting button: "</span> + holder.attr(<span class="hljs-string">'class'</span>))
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>        observer.disconnect()
        button.appendTo(found)
        enableObserver(observer)</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <pre><code>   <span class="hljs-keyword">else</span>
     <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Button already inserted: "</span> + holder.attr(<span class="hljs-string">'class'</span>))
 <span class="hljs-keyword">else</span>
   <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Couldn't find insert point '"</span> + insertSelector +
</code></pre><p>$          “‘ in “ + holder.attr(‘class’))</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

    observeConfig = { childList: <span class="hljs-literal">true</span>, subtree: <span class="hljs-literal">true</span> }
<span class="hljs-function">
    <span class="hljs-title">enableObserver</span> = <span class="hljs-params">(observer)</span> -&gt;</span>
      observer.observe(h.holder[<span class="hljs-number">0</span>], observeConfig) <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> holders

    observer = <span class="hljs-keyword">new</span> MutationObserver(<span class="hljs-function"><span class="hljs-params">(mutations, observer)</span> -&gt;</span>
      mutations.forEach(<span class="hljs-function"><span class="hljs-params">(mutation)</span> -&gt;</span>
        target = mutation.target
        <span class="hljs-keyword">if</span> !(target <span class="hljs-keyword">in</span> (h.holder[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> holders) )
          <span class="hljs-keyword">return</span>
        holder = $(mutation.target)
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"mutation: "</span> + holder.attr(<span class="hljs-string">'class'</span>))
        insertSelector = holder.data(<span class="hljs-string">'insertSelector'</span>)
        updateButton(holder, insertSelector)

        )
      )
<span class="hljs-function">
    <span class="hljs-title">button_inserter</span> = <span class="hljs-params">(tab, holder, insertSelector, prepend)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>store for observer’s use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      holder.data(<span class="hljs-string">'insertSelector'</span>, insertSelector)

      found_early = holder.find(insertSelector)
      <span class="hljs-keyword">if</span> found_early.length &gt; <span class="hljs-number">0</span>
        button.appendTo(found_early)

      tab.<span class="hljs-literal">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">-&gt;</span>
        updateButton(holder, insertSelector)
      )

    button_inserter(h.tab, h.holder, h.insertSelector, <span class="hljs-literal">false</span>) <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> holders
    enableObserver(observer)

    <span class="hljs-keyword">return</span> button
<span class="hljs-function">
<span class="hljs-title">humble_make_button</span> = -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Humble Library uses very weird button markup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  label = $(<span class="hljs-string">'&lt;span class="label"&gt;&lt;/span&gt;'</span>).html(BUTTON_LABEL)
  a = $(<span class="hljs-string">'&lt;a class="a" href="#"&gt;&lt;/span&gt;'</span>)
    .html(BUTTON_LABEL)</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Apparently the <code>noicon</code> class isn’t versatile enough</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    .css(<span class="hljs-string">'padding-left'</span>, <span class="hljs-string">'9px'</span>)

  button = $(<span class="hljs-string">'&lt;div class="flexbtn active noicon"&gt;&lt;/div&gt;'</span>)
  .append(<span class="hljs-string">'&lt;div class="right"&gt;&lt;/div&gt;'</span>)
  .append(label)
  .append(a)
<span class="hljs-function">
<span class="hljs-title">humble_parse_single</span> = <span class="hljs-params">(cb)</span> -&gt;</span>
  cb(({ title: x.textContent.trim(), sources: [<span class="hljs-string">'humblestore'</span>]
    } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'div.row'</span>)).has(</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Humble Library has no easy way to list only games</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">' .downloads.windows .download,
      .downloads.linux .download,
      .downloads.mac .download,
      .downloads.android .download'</span>
    ).find(<span class="hljs-string">'div.title'</span>))</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>##
Use website’s model objects to collect and process game data.</p>
<p> Because the actual data isn’t easily accessible, this creates
 a new instance of the model object, and probably re-downloads
 all the game information, so should only be run when the import
 button is pressed, to prevent slowdowns of the website.</p>
<p>##</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">humble_read_library</span> = <span class="hljs-params">(cb)</span> -&gt;</span>
  requirejs([<span class="hljs-string">'downloadPages/orderCollection'</span>],
    <span class="hljs-function"><span class="hljs-params">(OrderCollection)</span> -&gt;</span>
      orderList = ({gamekey: g} <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> gamekeys)
      orderModels = <span class="hljs-keyword">new</span> OrderCollection(orderList)

      items = {}
<span class="hljs-function">
      <span class="hljs-title">hasApp</span> = <span class="hljs-params">(subProduct)</span> -&gt;</span>
        <span class="hljs-keyword">for</span> download <span class="hljs-keyword">in</span> subProduct.downloads
          <span class="hljs-keyword">if</span> download.platform <span class="hljs-keyword">in</span> [<span class="hljs-string">'windows'</span>, <span class="hljs-string">'mac'</span>, <span class="hljs-string">'linux'</span>]
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
<span class="hljs-function">
      <span class="hljs-title">addItem</span> = <span class="hljs-params">(name, source)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">of</span> items
          sources = items[name]
          <span class="hljs-keyword">if</span> !(source <span class="hljs-keyword">in</span> sources)
            sources.push(source)
        <span class="hljs-keyword">else</span>
          items[name] = [source]
<span class="hljs-function">

      <span class="hljs-title">processOrder</span> = <span class="hljs-params">(orderModel)</span> -&gt;</span>
        <span class="hljs-keyword">for</span> subProduct <span class="hljs-keyword">in</span> orderModel.getSubProducts()
          subProductHumanName = subProduct.human_name
          <span class="hljs-keyword">if</span> subProduct.library_family_name
            subProductLFN =  subProduct.library_family_name
          <span class="hljs-keyword">else</span>
            subProductLFN = <span class="hljs-string">""</span>
          <span class="hljs-keyword">if</span> subProductLFN == <span class="hljs-string">'hidden'</span>
            <span class="hljs-keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Direct downloads are marked as ‘Humble Store’ copies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (hasApp(subProduct))
            addItem(subProductHumanName, <span class="hljs-string">'humblestore'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>3rd party keys, try to use the origin of the key
<em>TODO</em> try to mark keys as ‘extra’ when not redeemed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> tpkModel <span class="hljs-keyword">in</span> orderModel.getTpkModels()
          tpkLFNAttr = tpkModel.get(<span class="hljs-string">'library_family_name'</span>)
          tpkLFN =
          <span class="hljs-keyword">if</span> tpkLFNAttr
            tpkLFNAttr
          <span class="hljs-keyword">else</span>
            <span class="hljs-string">""</span>
          keyType = tpkModel.get(<span class="hljs-string">'key_type'</span>)
          tpkHumanName = tpkModel.get(<span class="hljs-string">'human_name'</span>)
          <span class="hljs-keyword">if</span> (!tpkHumanName)
            tpkHumanName = orderModel.getProduct().human_name
          <span class="hljs-keyword">if</span>(tpkLFN == <span class="hljs-string">'hidden'</span>)
            <span class="hljs-keyword">return</span>

          addItem(tpkHumanName, keyType)


      orderModels.forEach( <span class="hljs-function"><span class="hljs-params">(orderModel)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> (orderModel.loaded)
          processOrder(orderModel)
        <span class="hljs-keyword">else</span>
          orderModel.fetch({
            success: <span class="hljs-function"><span class="hljs-params">(fetched)</span> -&gt;</span>
              processOrder(orderModel)
            }))

      list = ({title: name, sources: srcs} <span class="hljs-keyword">for</span> name,srcs <span class="hljs-keyword">of</span> items)
      cb(list)
  )
<span class="hljs-function">



<span class="hljs-title">shinyloot_insert_button</span> = -&gt;</span>
  $(<span class="hljs-string">'&lt;button&gt;&lt;/button&gt;'</span>)
  .html(BUTTON_LABEL).css</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>ShinyLoot’s buttons are a chimeric grab-bag and
the nicest looking ones have site-provided CSS
that’s tied to markup using <code>&lt;ul&gt;</code> and <code>&lt;li&gt;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    background: <span class="hljs-string">'url("/images/filters/sort-background-inactive.png") '</span> +
                <span class="hljs-string">'repeat-x scroll 0% 0% transparent'</span>
    border: <span class="hljs-string">'1px solid #666'</span>
    borderRadius: <span class="hljs-string">'2px'</span>
    boxShadow: <span class="hljs-string">'0px 1px 6px #777'</span>
    color: <span class="hljs-string">'#222'</span>
    fontSize: <span class="hljs-string">'12px'</span>
    fontWeight: <span class="hljs-string">'bold'</span>
    fontFamily: <span class="hljs-string">'Arial,Helvetica,Sans-serif'</span>
    float: <span class="hljs-string">'right'</span>
    padding: <span class="hljs-string">'2px 8px'</span>
    marginRight: <span class="hljs-string">'-6px'</span>
    verticalAlign: <span class="hljs-string">'middle'</span>
  .appendTo(<span class="hljs-string">'#content .header'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Scrapers are looked up first by domain (lightweight) and then by
a regex check on the URL (accurate).
This should allow for extremely robust scaling as well as enabling the
possibility of a build script which automatically generates the
Greasemonkey <code>@include</code> lines.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>scrapers =
  <span class="hljs-string">'www.dotemu.com'</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Each profile can be an object or a list of objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">'https://www\\.dotemu\\.com/(en|fr|es)/user/?'</span>: [</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The store being imported from</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'dotemu'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Each scraper must have a <code>game_list</code> method which returns…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
          cb({</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>…one or both of <code>title</code> and <code>url</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            title: attr(x, <span class="hljs-string">'title'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>We’re guaranteed an absolute URL if we use the DOM href property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            url: x.href</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>The stores which should be added to the user’s “owned on” list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            sources: [<span class="hljs-string">'dotemu'</span>]
          } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'div.my-games div.field-title a'</span>))</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Each scraper must have an <code>insert_button</code> member which adds
a button to the DOM using <code>BUTTON_LABEL</code> and then returns
a jQuery wrapper so the click handler can be bound.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span> dotemu_add_button(<span class="hljs-string">'div.my-games h2.pane-title'</span>)
      ,
        <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'dotemu'</span>
        <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
          cb({
            title: attr(x, <span class="hljs-string">'title'</span>)
            url: x.href
            sources: [<span class="hljs-string">'dotemu'</span>]
          } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'div.user-wishlist .views-field-title-1 a'</span>))
        <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span> dotemu_add_button(<span class="hljs-string">'.user-wishlist h2.pane-title'</span>)
        <span class="hljs-string">'is_wishlist'</span>: <span class="hljs-literal">true</span>
      ]

  <span class="hljs-string">'fireflowergames.com'</span>:
    <span class="hljs-string">'^http://fireflowergames\\.com/my-lists/(edit-my|view-a)-list/\\?.+'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'fireflower'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        results = $(<span class="hljs-string">'table.wl-table tbody td.check-column input:checked'</span>)
          .parents(<span class="hljs-string">'tr'</span>).find(<span class="hljs-string">'td.product-name a'</span>)

        <span class="hljs-keyword">if</span> (!results.length)
          results = $(<span class="hljs-string">'table.wl-table td.product-name a'</span>)

        cb({
          title: $(x).text().trim()
          url: x.href
          sources: [<span class="hljs-string">'fireflower'</span>]
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> results)
      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>XXX: If you can debug the broken behaviour with <button>, please do.
I don’t have time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'&lt;a class="button"&gt;&lt;/a&gt;'</span>)
          .html(BUTTON_LABEL)
          .wrap(<span class="hljs-string">'&lt;td&gt;&lt;/td&gt;'</span>)
          .appendTo($(<span class="hljs-string">'table.wl-actions-table tbody:first'</span>).find(<span class="hljs-string">'tr:last'</span>))
      <span class="hljs-string">'is_wishlist'</span>: <span class="hljs-literal">true</span>

  <span class="hljs-string">'flyingbundle.com'</span>:
    <span class="hljs-string">'https?://(www\\.)?flyingbundle\\.com/users/account'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'flying_bundle'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span> cb({
        title: $(x).text()
        sources: <span class="hljs-string">'flying_bundle'</span>
      } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">".div_btn_download[href^='/users/sources']"</span>
      ).parents(<span class="hljs-string">'li'</span>).find(<span class="hljs-string">':first'</span>))
      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span>
        li = $(<span class="hljs-string">"&lt;li&gt;&lt;/li&gt;"</span>
        ).appendTo(<span class="hljs-string">'.legenda_points ul'</span>)
        $(<span class="hljs-string">'&lt;a href="#"&gt;'</span> + BUTTON_LABEL + <span class="hljs-string">' &lt;img src="'</span> + ITAD_14X14_GRAY +
          <span class="hljs-string">'" /&gt;&lt;/a&gt;'</span>)
          .css(<span class="hljs-string">'text-transform'</span>, <span class="hljs-string">'uppercase'</span>)
          .wrap(<span class="hljs-string">"&lt;li&gt;&lt;/li&gt;"</span>)
          .appendTo(li)

  <span class="hljs-string">'www.gog.com'</span>:
    <span class="hljs-string">'^https://www\\.gog\\.com/order/status/.+'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'gog'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">"game_list called for GOG order status page"</span>)
        cb({
          title: gog_prepare_title(x)
          sources: [<span class="hljs-string">'gog'</span>]
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'.order + .container .product-row'</span>))

      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">"insert_button called for GOG order status page"</span>)
        $(<span class="hljs-string">".order-article__btn-pointer-wrapper .order-article__btn-pointer"</span>)
          .css({
            marginTop: <span class="hljs-number">-4</span>,
            zIndex: <span class="hljs-number">20</span>,
          })
        $(<span class="hljs-string">'.order-article__dropdown-items'</span>).css(<span class="hljs-string">'z-index'</span>, <span class="hljs-number">10</span>)
        $(<span class="hljs-string">"&lt;a class='_dropdown__item ng-scope'&gt;&lt;/a&gt;"</span>)
          .html(<span class="hljs-string">"On ITAD"</span>)
          .prependTo($(<span class="hljs-string">'.order-message__actions ._dropdown__items'</span>)
            .filter(<span class="hljs-string">':first'</span>))

    <span class="hljs-string">'^https?://www\\.gog\\.com/account(/games(/(shelf|list))?)?/?(\\?|$)'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'gog'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">"game_list called for GOG collection page"</span>)
        cb({
          id: attr(x, <span class="hljs-string">'gog-product'</span>)
          title: gog_prepare_title(x)
          sources: [<span class="hljs-string">'gog'</span>]
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'.product-row'</span>))

      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-built_in">console</span>.debug(<span class="hljs-string">"insert_button called for GOG collection page"</span>)
        $(<span class="hljs-string">"&lt;span&gt;&lt;/span&gt;"</span>)
        .css
          float: <span class="hljs-string">'right'</span>
          cursor: <span class="hljs-string">'pointer'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>TODO: Replace the following hacks with whatever GOG uses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          position: <span class="hljs-string">'relative'</span>
          marginBottom: <span class="hljs-string">'-2em'</span>
          zIndex: <span class="hljs-number">1</span>
        .html(BUTTON_LABEL + <span class="hljs-string">" (This Page)"</span>)
        .prependTo($(<span class="hljs-string">'.collection-header'</span>).filter(<span class="hljs-string">':first'</span>))

  <span class="hljs-string">'groupees.com'</span>:
    <span class="hljs-string">'https?://(www\\.)?groupees\\.com/(purchases|users/\\d+)'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'other'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        cb({
          title: x.textContent.trim(),
          sources: [<span class="hljs-string">'other'</span>]
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'.product ul.dropdown-menu'</span>)
                    .parents(<span class="hljs-string">'.details'</span>).find(<span class="hljs-string">'h3'</span>))
      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span>
        $(<span class="hljs-string">"&lt;button&gt;&lt;/button&gt;"</span>)
          .css({ float: <span class="hljs-string">'right'</span> }).addClass(<span class="hljs-string">'button btn btn-sm btn-primary'</span>)
          .html(BUTTON_LABEL + <span class="hljs-string">" (Selected Bundle)"</span>)
          .insertBefore(<span class="hljs-string">"input[name='search']"</span>)

  <span class="hljs-string">'www.humblebundle.com'</span>:
    <span class="hljs-string">'https://www\\.humblebundle\\.com/home/library/?'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'humblestore'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span> cb({
        title: x.textContent.trim(), sources: [<span class="hljs-string">'humblestore'</span>]
      } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'.subproduct-selector h2'</span>))</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>TODO: Figure out how to filter out non-games again
TODO: Figure out how to tap their Backbone.js store</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-string">'insert_button'</span>: humble_make_library_button

    <span class="hljs-string">'https://www\\.humblebundle\\.com/home/?'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'humblestore'</span>
      <span class="hljs-string">'game_list'</span>: humble_read_library
      <span class="hljs-string">'insert_button'</span>: humble_make_library_button

    <span class="hljs-string">'https://www\\.humblebundle\\.com/(download)?s\\?key=.+'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'humblestore'</span>
      <span class="hljs-string">'game_list'</span>: humble_parse_single
      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span>
        parent = $(<span class="hljs-string">'.js-gamelist-holder'</span>).parents(<span class="hljs-string">'.whitebox'</span>)
        parent.find(<span class="hljs-string">'.staple.s4'</span>).remove()

        humble_make_button().css
          position: <span class="hljs-string">'absolute'</span>
          top: <span class="hljs-number">11</span>
          right: <span class="hljs-number">17</span>
        .appendTo(parent)


  <span class="hljs-string">'indiegamestand.com'</span>:
    <span class="hljs-string">'https://indiegamestand\\.com/wallet\\.php'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'indiegamestand'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        cb({</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><strong>Note:</strong> IGS game URLs change during promos and some IGS wallet
entries may not have them (eg. entries just present to provide
a second steam key for some DLC from another entry)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          url: $(<span class="hljs-string">'.game-thumb'</span>, x)?.closest(<span class="hljs-string">'a'</span>)?[<span class="hljs-number">0</span>]?.href
          title: $(<span class="hljs-string">'.game-title'</span>, x).text().trim()
          sources: [<span class="hljs-string">'indiegamestand'</span>]
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'#wallet_contents .line-item'</span>))

      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span>
        $(<span class="hljs-string">'&lt;div class="request key"&gt;&lt;/div&gt;'</span>)
        .html(BUTTON_LABEL).wrapInner(<span class="hljs-string">"&lt;div&gt;&lt;/div&gt;"</span>).css
          display: <span class="hljs-string">'inline-block'</span>
          marginLeft: <span class="hljs-string">'1em'</span>
          verticalAlign: <span class="hljs-string">'middle'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>This would look nicer if floated right in <code>.titles</code> but
their button styles are scoped to <code>#game_wallet</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        .appendTo(<span class="hljs-string">'#game_wallet h2'</span>)
    <span class="hljs-string">'https://indiegamestand\\.com/wishlist\\.php'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'indiegamestand'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        cb({
          url: $(<span class="hljs-string">'.game-thumb'</span>, x)?.closest(<span class="hljs-string">'a'</span>)?[<span class="hljs-number">0</span>]?.href
          title: $(<span class="hljs-string">'.game_details h3'</span>, x).text().trim()
          sources: [<span class="hljs-string">'indiegamestand'</span>]
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'#store_browse_game_list .game_list_item'</span>))
      <span class="hljs-string">'is_wishlist'</span>: <span class="hljs-literal">true</span>

      <span class="hljs-string">'insert_button'</span>: <span class="hljs-function">-&gt;</span>
        innerDiv = $(<span class="hljs-string">"&lt;div&gt;&lt;/div&gt;"</span>).css
          paddingLeft: <span class="hljs-string">'10px'</span>
          background: (<span class="hljs-string">'url("images/icon-arrow.png") no-repeat scroll '</span> +
                      <span class="hljs-string">'155px 45% transparent'</span>)

        $(<span class="hljs-string">'&lt;div class="request key"&gt;&lt;/div&gt;'</span>)
        .html(BUTTON_LABEL).wrapInner(innerDiv).css <span class="hljs-comment"># IGS CSS</span>
          display: <span class="hljs-string">'inline-block'</span>
          verticalAlign: <span class="hljs-string">'middle'</span>
          float: <span class="hljs-string">'right'</span>
          width: <span class="hljs-string">'170px'</span>
          height: <span class="hljs-string">'21px'</span>
          background: (<span class="hljs-string">'url("images/btn-bg-blue-longer.png") '</span> +
                       <span class="hljs-string">'no-repeat scroll 0px 0px transparent'</span>)
          lineHeight: <span class="hljs-string">'21px'</span>
          color: <span class="hljs-string">'#FFF'</span>
          whiteSpace: <span class="hljs-string">'nowrap'</span>
          marginLeft: <span class="hljs-string">'1em'</span>
          marginBottom: <span class="hljs-string">'4px'</span>
          fontSize: <span class="hljs-string">'12px'</span>
          cursor: <span class="hljs-string">'pointer'</span>
        .css <span class="hljs-comment"># Our CSS</span>
          margin: <span class="hljs-string">'11px 5px auto auto'</span>
        .appendTo(<span class="hljs-string">'#store_browse_game_list .header'</span>)

  <span class="hljs-string">'www.shinyloot.com'</span>:
    <span class="hljs-string">'https?://www\\.shinyloot\\.com/m/games/?'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'shinyloot'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        cb({
          url: $(<span class="hljs-string">'.right-float a img'</span>, x).closest(<span class="hljs-string">'a'</span>)[<span class="hljs-number">0</span>].href
          title: $(x).prev(<span class="hljs-string">'h3'</span>).text().trim()
          sources: [<span class="hljs-string">'shinyloot'</span>]
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'#accordion .ui-widget-content'</span>))
      <span class="hljs-string">'insert_button'</span>: shinyloot_insert_button
    <span class="hljs-string">'https?://www\\.shinyloot\\.com/m/wishlist/?'</span>:
      <span class="hljs-string">'source_id'</span>: <span class="hljs-string">'shinyloot'</span>
      <span class="hljs-string">'game_list'</span>: <span class="hljs-function"><span class="hljs-params">(cb)</span> -&gt;</span>
        cb({
          url: $(<span class="hljs-string">'.gameInfo + a'</span>, x)[<span class="hljs-number">0</span>].href
          title: $(<span class="hljs-string">'.gameName'</span>, x).text().trim()
        } <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> $(<span class="hljs-string">'.gameItem'</span>))
      <span class="hljs-string">'insert_button'</span>: shinyloot_insert_button
      <span class="hljs-string">'is_wishlist'</span>: <span class="hljs-literal">true</span>

scrapers[<span class="hljs-string">'www.flyingbundle.com'</span>] = scrapers[<span class="hljs-string">'flyingbundle.com'</span>]
scrapers[<span class="hljs-string">'www.groupees.com'</span>] = scrapers[<span class="hljs-string">'groupees.com'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Callback for the button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">scrapeGames</span> = <span class="hljs-params">(scraper_obj)</span> -&gt;</span>
  
  scraper_obj.game_list( <span class="hljs-function"><span class="hljs-params">(game_list)</span> -&gt;</span>

    params = {
      json: JSON.stringify(game_list),
      source: scraper_obj.source_id
    }

    url = <span class="hljs-keyword">if</span> scraper_obj.is_wishlist?
      <span class="hljs-string">'https://isthereanydeal.com/outside/user/wait/3rdparty'</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-string">'https://isthereanydeal.com/outside/user/collection/3rdparty'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>TODO:</strong> Figure out why attempting to use an iframe for non-HTTPS sites
navigates the top-level window.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    form = $(<span class="hljs-string">"&lt;form id='itad_submitter' method='POST' /&gt;"</span>).attr(<span class="hljs-string">'action'</span>, url)
    params[<span class="hljs-string">'returnTo'</span>] = location.href</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Submit the form data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    form.css({ display: <span class="hljs-string">'none'</span> })
    $.each params, <span class="hljs-function"><span class="hljs-params">(key, value)</span> -&gt;</span>
      $(<span class="hljs-string">"&lt;input type='hidden' /&gt;"</span>)
        .attr(<span class="hljs-string">"name"</span>, key)
        .attr(<span class="hljs-string">"value"</span>, value)
        .appendTo(form)
    $(<span class="hljs-built_in">document</span>.body).append(form)
  
    form.submit()
  )</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>CoffeeScript shorthand for <code>$(document).ready(function() {</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$ -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Resolve and call the correct profile</p>
<p>It seems we don’t need an explicit <code>if location.host of scrapers</code>
before the <code>for</code> loop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Loading ITAD importer..."</span>)
  <span class="hljs-keyword">if</span> scrapers[location.host]
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Matched domain: "</span> + location.host)
    <span class="hljs-keyword">for</span> regex, profile <span class="hljs-keyword">of</span> scrapers[location.host]
      <span class="hljs-keyword">try</span>
        profile_matched = location.href.match(regex)
      <span class="hljs-keyword">catch</span> e
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Bad regex: "</span> + regex)

      <span class="hljs-keyword">if</span> profile_matched
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Matched profile: "</span> + regex)</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Allow reloading the script without reloading the page for RAD</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'.itad_btn, #itad_dlg, .itad_close'</span>).remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Simplify the following code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> Array.isArray(profile)
          profile = [profile]

        <span class="hljs-keyword">for</span> scraper <span class="hljs-keyword">in</span> profile</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>We’ll need a closure to ensure click() calls the proper scraper</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">do</span> (scraper) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Use the <code>?</code> existential operator to die quietly if the scraper
doesn’t have an <code>insert_button</code> member.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Inserting ITAD button for source ID: "</span> +
                        scraper.source_id)
            scraper.insert_button?().addClass(<span class="hljs-string">'itad_btn'</span>).click -&gt;
              <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"ITAD button clicked"</span>)
              scrapeGames(scraper)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>We only ever want to match one profile so break here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">break</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
